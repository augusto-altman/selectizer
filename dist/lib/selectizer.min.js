function ObjectSources(a,b){var c=require("path"),d=require("fs"),e=null,f={};return f.success=!1,f.data={},b=b||".",b=c.resolve(process.cwd(),b),a?d.existsSync(b+"/"+a)?d.existsSync(b+"/"+a+"/src")?d.existsSync(b+"/"+a+"/config")?(f.success=!0,f.data.object=a,f.data.objectFolder=b,f.data.config=e,f.data.paths={},f.data.paths.build=b+"/"+a+"/build/",f.data.paths.src=b+"/"+a+"/src/",f.data.paths.config=b+"/"+a+"/config/",e=require(f.data.paths.config+f.data.object+".config.json"),f.data.config=e||{},f.data.config.name=e.name||"",f.data.config.modules=e.modules||[],f.data.config.paths=e.paths||[],f.data.config.wrap=e.wrap||{}):(f.data.errorMsg="Error: The path "+b+"/"+a+"/config doesn't exist",f.data.errorCode=4):(f.data.errorMsg="Error: The path "+b+"/"+a+"/src doesn't exist",f.data.errorCode=3):(f.data.errorMsg="Error: The path "+b+"/"+a+" doesn't exist",f.data.errorCode=2):(f.data.errorMsg="Error: Generation requires an object name.",f.data.errorCode=1),f}var GenerationHandler=function(){function a(){var a="require([",b=0,d=null;for(var e in this.data.config.modules)a+=0===b?'"'+this.data.config.modules[e]+'"':', "'+this.data.config.modules[e]+'"',b++;return a+="], function() {\n",d=c.readFileSync(this.data.paths.config+this.data.object+".initCode.js","utf8"),a+=d+"\n});",c.writeFileSync(this.data.paths.build+this.data.object+"-init.js",a)}function b(b){d(this.data.paths.build,function(d){d?b({success:!1,data:{errorMsg:d,errorCode:0}}):(a.call(this),e.optimize(this.data.requireJSOptions,function(){var a=c.readFileSync(this.data.requireJSOptions.out,"utf8");a=a.replace('define("../build/'+this.data.object+'-init", function(){});',""),a=a.replace('define("'+this.data.object+'", function(){});',""),a=a.replace(/\s*?\n\s*?;\n/g,"\n"),c.writeFileSync(this.data.requireJSOptions.out,a,"utf8"),c.unlinkSync(this.data.paths.build+this.data.object+"-init.js"),b({success:!0,data:{msg:"Object created in "+this.data.paths.build}})}.bind(this),function(a){c.unlinkSync(this.data.paths.build+this.data.object+"-init.js"),b({success:!1,data:{errorMsg:a,errorCode:0}})}))}.bind(this))}var c=require("fs"),d=require("mkdirp"),e=require("requirejs");return function(a,c){var d=Object.create(ObjectSources(a,c));return d.success&&(d.generate=b,d.data.requireJSOptions={baseUrl:d.data.paths.src,name:"../build/"+d.data.object+"-init",out:d.data.paths.build+d.data.object+".js",optimize:"none",useStrict:!0,paths:d.data.config.paths,wrap:d.data.config.wrap,onBuildWrite:function(a,b,c){return/define\(.*?\{/.test(c)?(c=c.replace(/define\(.*?\{/,""),c=c.replace(/\}\);\s*?$/,""),c=c.replace(/return.*[^return]*$/,"")):/require\([^\{]*?\{/.test(c)&&(c=c.replace(/require[^\{]+\{/,""),c=c.replace(/\}\);\s*$/,"")),c}}),d}}();module.exports=GenerationHandler;